import{a as ct}from"./chunk-ZN7N3DZ7.js";import{a as rt,b as st}from"./chunk-4I7E6TY2.js";import"./chunk-72DCKGH5.js";import{a as pt,b as dt}from"./chunk-EMY7YEHD.js";import{a as U,b as V,c as W,d as q,e as J,f as K,g as Q,h as X,i as Y,j as Z,k as tt}from"./chunk-JFHP4756.js";import"./chunk-MS4AQ6UA.js";import"./chunk-GKRR3LY4.js";import{d as it,h as ot,i as lt}from"./chunk-BOKKIAFZ.js";import{a as nt}from"./chunk-6Y7QP5KE.js";import{b as et,i as at}from"./chunk-M5CW5NFQ.js";import"./chunk-6J5RYYQJ.js";import{a as mt}from"./chunk-KCUSWNL7.js";import{a as $,b as k}from"./chunk-LTI5L47W.js";import"./chunk-G6RQVBEQ.js";import{w as j}from"./chunk-C2MAVCXR.js";import"./chunk-7U2T7U2W.js";import{X as N,Z as B}from"./chunk-3B4OGLPL.js";import{Ac as O,Ga as r,Ic as R,Ka as v,Mb as l,Nb as g,Ob as L,Oc as H,Qb as P,Qc as z,Ra as I,Rb as w,Sb as T,Va as p,Vb as D,Y as x,aa as M,ga as E,ha as y,kb as s,lb as i,mb as n,nb as _,o as S,rb as c,sb as f,ub as G,wb as u,yb as C,zc as F}from"./chunk-FEQCTJNV.js";import"./chunk-TSRGIXR5.js";var b=class t{constructor(e){this.http=e}baseUrl=`${mt}/alertas/`;getAllPaginated(e=0,a=10,o){let m=e*a,d=m+a-1,h=new H().set("range",`[${m},${d}]`);return o&&o!==""&&(h=h.set("id_estado",o)),this.http.get(this.baseUrl,{params:h,observe:"response"}).pipe(S(A=>{let gt=A.headers.get("Content-Range")||"",_t=this.extractTotalFromRange(gt);return{data:A.body||[],total:_t}}))}extractTotalFromRange(e){let a=e.match(/\/(\d+)$/);return a?parseInt(a[1],10):0}static \u0275fac=function(a){return new(a||t)(M(z))};static \u0275prov=x({token:t,factory:t.\u0275fac,providedIn:"root"})};var bt=()=>[5,10,25];function ht(t,e){if(t&1&&(i(0,"mat-option",11),l(1),n()),t&2){let a=e.$implicit;s("value",a.IdEstado),r(),L(" ",a.nombre," ")}}function vt(t,e){t&1&&(i(0,"div",12),_(1,"mat-spinner",13),i(2,"p"),l(3,"Cargando alertas..."),n()())}function At(t,e){t&1&&(i(0,"th",24),l(1,"ID"),n())}function St(t,e){if(t&1&&(i(0,"td",25),l(1),n()),t&2){let a=e.$implicit;r(),g(a.idAlerta)}}function xt(t,e){t&1&&(i(0,"th",24),l(1,"Estado"),n())}function Mt(t,e){if(t&1&&(i(0,"td",25),l(1),n()),t&2){let a=e.$implicit;r(),g(a.estado_nombre)}}function Et(t,e){t&1&&(i(0,"th",24),l(1,"Asunto"),n())}function yt(t,e){if(t&1&&(i(0,"td",25),l(1),n()),t&2){let a=e.$implicit;r(),g(a.Asunto)}}function It(t,e){t&1&&(i(0,"th",24),l(1,"Mensaje"),n())}function Gt(t,e){if(t&1&&(i(0,"td",25),l(1),n()),t&2){let a=e.$implicit;r(),g(a.Mensaje)}}function Lt(t,e){t&1&&_(0,"tr",26)}function Pt(t,e){t&1&&_(0,"tr",27)}function wt(t,e){if(t&1&&(i(0,"div",14)(1,"table",15),c(2,16),p(3,At,2,0,"th",17)(4,St,2,1,"td",18),f(),c(5,19),p(6,xt,2,0,"th",17)(7,Mt,2,1,"td",18),f(),c(8,20),p(9,Et,2,0,"th",17)(10,yt,2,1,"td",18),f(),c(11,21),p(12,It,2,0,"th",17)(13,Gt,2,1,"td",18),f(),p(14,Lt,1,0,"tr",22)(15,Pt,1,0,"tr",23),n()()),t&2){let a=C();r(),s("dataSource",a.alertas),r(13),s("matHeaderRowDef",a.displayedColumns),r(),s("matRowDefColumns",a.displayedColumns)}}function Tt(t,e){t&1&&(i(0,"div",28)(1,"p"),l(2,"No hay alertas en el sistema."),n()())}function Dt(t,e){if(t&1){let a=G();i(0,"mat-paginator",29),u("page",function(m){E(a);let d=C();return y(d.onPageChange(m))}),n()}if(t&2){let a=C();s("length",a.totalAlertas)("pageSize",a.pageSize)("pageSizeOptions",D(3,bt))}}var ft=class t{constructor(e,a){this.alertaGlobalService=e;this.estadoAlertaService=a}alertas=[];totalAlertas=0;pageSize=10;currentPage=0;loading=!1;displayedColumns=["idAlerta","Estado","Asunto","Mensaje"];estadosAlerta=[];selectedEstado=1;ngOnInit(){this.loadEstadosAlerta(),this.loadAlertas()}loadEstadosAlerta(){this.estadoAlertaService.getEstadosAlerta().subscribe({next:e=>{this.estadosAlerta=e},error:e=>{console.error("Error cargando estados de alerta:",e)}})}loadAlertas(e=0,a=this.pageSize){this.loading=!0;let o=this.selectedEstado?this.selectedEstado.toString():"";this.alertaGlobalService.getAllPaginated(e,a,o).subscribe({next:m=>{this.alertas=m.data,this.totalAlertas=m.total,this.loading=!1},error:()=>{this.alertas=[],this.totalAlertas=0,this.loading=!1}})}onFilterChange(){this.currentPage=0,this.loadAlertas(0,this.pageSize)}clearFilter(){this.selectedEstado="",this.onFilterChange()}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.loadAlertas(this.currentPage,this.pageSize)}static \u0275fac=function(a){return new(a||t)(v(b),v(ct))};static \u0275cmp=I({type:t,selectors:[["app-alertas-global-list"]],decls:18,vars:6,consts:[[1,"alertas-container"],[1,"filters-container"],["appearance","outline",1,"filter-field"],[3,"valueChange","selectionChange","value"],["value",""],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","title","Limpiar filtro",1,"clear-filter-btn",3,"click"],["class","loading-container",4,"ngIf"],["class","table-container",4,"ngIf"],["class","no-data",4,"ngIf"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],[3,"value"],[1,"loading-container"],["diameter","32"],[1,"table-container"],["mat-table","",1,"mat-elevation-2",3,"dataSource"],["matColumnDef","idAlerta"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Estado"],["matColumnDef","Asunto"],["matColumnDef","Mensaje"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"no-data"],[3,"page","length","pageSize","pageSizeOptions"]],template:function(a,o){a&1&&(i(0,"div",0)(1,"h2"),l(2,"Alertas del Sistema"),n(),i(3,"div",1)(4,"mat-form-field",2)(5,"mat-label"),l(6,"Estado"),n(),i(7,"mat-select",3),T("valueChange",function(d){return w(o.selectedEstado,d)||(o.selectedEstado=d),d}),u("selectionChange",function(){return o.onFilterChange()}),i(8,"mat-option",4),l(9,"Todos los estados"),n(),p(10,ht,2,2,"mat-option",5),n()(),i(11,"button",6),u("click",function(){return o.clearFilter()}),i(12,"mat-icon"),l(13,"clear"),n()()(),p(14,vt,4,0,"div",7)(15,wt,16,3,"div",8)(16,Tt,3,0,"div",9)(17,Dt,1,4,"mat-paginator",10),n()),a&2&&(r(7),P("value",o.selectedEstado),r(3),s("ngForOf",o.estadosAlerta),r(4),s("ngIf",o.loading),r(),s("ngIf",!o.loading&&o.alertas.length>0),r(),s("ngIf",!o.loading&&o.alertas.length===0),r(),s("ngIf",o.totalAlertas>0))},dependencies:[R,F,O,j,tt,U,W,Q,q,V,X,J,K,Y,Z,st,rt,dt,pt,lt,at,et,ot,it,nt,B,N,k,$],styles:["[_nghost-%COMP%]{display:block;background:#fff;box-shadow:0 2px 8px #0000000a;border-radius:8px;padding:24px}.filters-container[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:24px;align-items:center}.filter-field[_ngcontent-%COMP%]{min-width:200px}.clear-filter-btn[_ngcontent-%COMP%]{color:#666}.loading-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin:16px 0}.table-container[_ngcontent-%COMP%]{overflow-x:auto;margin-top:1rem}.no-data[_ngcontent-%COMP%]{color:#888;font-style:italic;margin-top:16px}"]})};export{ft as AlertasGlobalListComponent};
